<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>AeroTap — One Tap, Endless Adventure!</title>
<style>
  :root{
    --bg1:#0f1724; --bg2:#0b3b4c; --accent:#ffd166; --muted:#98a8b9;
    --card:#0f1724aa;
  }
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans",Helvetica,Arial; background:linear-gradient(180deg,var(--bg1),var(--bg2)); color:#e6eef5}
  .wrap{max-width:900px;margin:18px auto;padding:12px;}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px}
  h1{font-size:20px;margin:0;color:var(--accent)}
  .meta{font-size:13px;color:var(--muted)}
  #gameCanvas{display:block;width:100%;height:70vh;border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,0.6);background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);}
  .hud{display:flex;gap:10px;align-items:center;margin-top:8px}
  .badge{background:rgba(255,255,255,0.03);padding:8px 12px;border-radius:10px;font-weight:600}
  .controls{display:flex;gap:8px}
  button.btn{background:var(--accent);border:0;padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer}
  .muted{color:var(--muted);font-size:13px}
  .center{display:flex;align-items:center;justify-content:center}
  .overlay{
    position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
    pointer-events:none;
  }
  @media(max-width:520px){
    h1{font-size:18px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>AeroTap</h1>
        <div class="meta">One-tap arcade • Tap to change direction • Collect coins & beat the high score</div>
      </div>
      <div class="meta">Version: 1.0</div>
    </header>

    <div style="position:relative;margin-top:12px;">
      <canvas id="gameCanvas"></canvas>
      <div class="overlay" id="overlay" style="pointer-events:auto"></div>
    </div>

    <div class="hud">
      <div class="badge">Score: <span id="score">0</span></div>
      <div class="badge">Best: <span id="best">0</span></div>
      <div style="flex:1"></div>
      <div class="controls">
        <button id="startBtn" class="btn">Start</button>
        <button id="muteBtn" class="btn" style="background:#7aa2ff">Mute</button>
      </div>
    </div>

    <p class="muted" style="margin-top:10px">Tip: collect coins to unlock new skins — easy to monetize with IAP or rewarded ads.</p>
  </div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d', { alpha: false });
let DPR = window.devicePixelRatio || 1;
function resize(){
  const w = Math.min(window.innerWidth-40, 900);
  const h = Math.max(window.innerHeight*0.64, 420);
  canvas.style.width = w + 'px';
  canvas.style.height = h + 'px';
  canvas.width = Math.round(w * DPR);
  canvas.height = Math.round(h * DPR);
  ctx.setTransform(DPR,0,0,DPR,0,0);
}
window.addEventListener('resize', resize);
resize();

let running = false;
let scoreEl = document.getElementById('score');
let bestEl = document.getElementById('best');
let startBtn = document.getElementById('startBtn');
let overlay = document.getElementById('overlay');
let muteBtn = document.getElementById('muteBtn');

let score = 0;
let best = Number(localStorage.getItem('aerotap_best')||0);
bestEl.textContent = best;
let speed = 2.2;
let difficulty = 0.0009;
let spawnTimer = 0;
let spawnInterval = 1200;

let audioCtx = null;
let soundOn = true;
function initAudio(){
  try {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  } catch(e){ audioCtx = null; soundOn=false; muteBtn.style.opacity=0.5; }
}
initAudio();

function beep(freq, duration=0.08, gain=0.08){
  if(!audioCtx || !soundOn) return;
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = 'sine';
  o.frequency.value = freq;
  g.gain.value = gain;
  o.connect(g); g.connect(audioCtx.destination);
  o.start();
  o.stop(audioCtx.currentTime + duration);
}

const Player = {
  x: 120, y: 150, r: 18,
  vy: 0, dir: 1,
  colorFrom: '#9be7ff', colorTo:'#7aa2ff',
  reset(){
    this.x = canvas.width/DPR * 0.25;
    this.y = canvas.height/DPR/2;
    this.r = Math.max(12, Math.min(26, canvas.width/DPR * 0.03));
    this.vy = 0; this.dir = 1;
  },
  update(dt){
    this.y += this.vy * dt;
    const H = canvas.height/DPR;
    if(this.y < this.r) { this.y = this.r; this.vy = 0; }
    if(this.y > H - this.r) { this.y = H - this.r; this.vy = 0; }
    const W = canvas.width/DPR;
    const targetX = (this.dir === 1) ? W*0.72 : W*0.28;
    this.x += (targetX - this.x) * 0.08;
  },
  draw(){
    const g = ctx.createLinearGradient(this.x - this.r, this.y - this.r, this.x + this.r, this.y + this.r);
    g.addColorStop(0, this.colorFrom); g.addColorStop(1, this.colorTo);
    ctx.beginPath(); ctx.fillStyle = g;
    ctx.arc(this.x, this.y, this.r, 0, Math.PI*2);
    ctx.fill();
    ctx.beginPath(); ctx.fillStyle = 'rgba(0,0,0,0.12)';
    ctx.ellipse(this.x + this.r*0.3, this.y + this.r*0.9, this.r*0.9, this.r*0.45, 0, 0, Math.PI*2);
    ctx.fill();
  }
};

let obstacles = [];
let coins = [];
let lastTime = 0;

function rand(min,max){ return Math.random()*(max-min)+min; }
function now(){ return performance.now(); }

function spawnObstacle(){
  const H = canvas.height/DPR;
  const W = canvas.width/DPR;
  const size = rand(H*0.08, H*0.22);
  const gap = rand(H*0.24, H*0.42);
  const top = rand(40, H - gap - 40);
  const x = W + 80;
  obstacles.push({x, top, size, gap, w: size*0.6, passed:false});
}
function spawnCoin(){
  const H = canvas.height/DPR;
  const W = canvas.width/DPR;
  const y = rand(60, H-60);
  const x = W + 120;
  coins.push({x,y,r:Math.max(6,Math.min(12, W*0.01)),collected:false});
}

function circleRectColl(cx,cy,cr,rx,ry,rw,rh){
  const closestX = Math.max(rx, Math.min(cx, rx+rw));
  const closestY = Math.max(ry, Math.min(cy, ry+rh));
  const dx = cx-closestX, dy = cy-closestY;
  return (dx*dx + dy*dy) <= cr*cr;
}

function update(dt){
  speed += difficulty * dt;
  spawnTimer += dt*1000;
  if(spawnTimer > spawnInterval){
    spawnTimer = 0;
    spawnObstacle();
    if(Math.random() < 0.55) spawnCoin();
    spawnInterval = Math.max(700, spawnInterval - 18);
  }

  Player.update(dt);

  const W = canvas.width/DPR;
  for(let i=obstacles.length-1;i>=0;i--){
    let o = obstacles[i];
    o.x -= speed * 60 * dt;
    const topRect = {x: o.x, y: 0, w: o.w, h: o.top};
    const botRect = {x: o.x, y: o.top + o.gap, w: o.w, h: canvas.height/DPR - (o.top + o.gap)};
    if(circleRectColl(Player.x, Player.y, Player.r, topRect.x, topRect.y, topRect.w, topRect.h) ||
       circleRectColl(Player.x, Player.y, Player.r, botRect.x, botRect.y, botRect.w, botRect.h)){
         endGame();
         return;
    }
    if(!o.passed && o.x + o.w < Player.x){
      o.passed = true;
      score += 10;
      scoreEl.textContent = score;
      beep(880,0.06,0.05);
    }
    if(o.x + o.w < -60) obstacles.splice(i,1);
  }

  for(let i=coins.length-1;i>=0;i--){
    let c = coins[i];
    c.x -= speed * 60 * dt;
    const dx = c.x - Player.x, dy = c.y - Player.y;
    if(!c.collected && (dx*dx + dy*dy) < Math.pow(c.r + Player.r*0.9, 2)){
      c.collected = true;
      score += 25;
      scoreEl.textContent = score;
      beep(1320,0.06,0.07);
      setTimeout(()=>{ const idx = coins.indexOf(c); if(idx>=0) coins.splice(idx,1); }, 120);
    }
    if(c.x + 40 < -100) coins.splice(i,1);
  }
}

function drawBackground(){
  const W = canvas.width/DPR, H = canvas.height/DPR;
  ctx.fillStyle = 'rgba(255,255,255,0.02)';
  ctx.fillRect(0,0,W,H);
  const grad = ctx.createLinearGradient(0,0,0,H);
  grad.addColorStop(0,'rgba(255,255,255,0.02)');
  grad.addColorStop(1,'rgba(0,0,0,0.06)');
  ctx.fillStyle = grad;
  ctx.fillRect(0,0,W,H);
}

function draw(){
  const W = canvas.width/DPR, H = canvas.height/DPR;
  ctx.clearRect(0,0,W,H);
  drawBackground();

  for(let o of obstacles){
    ctx.fillStyle = 'rgba(20,30,40,0.95)';
    ctx.fillRect(o.x, 0, o.w, o.top);
    ctx.fillRect(o.x, o.top + o.gap, o.w, H - (o.top + o.gap));
    ctx.strokeStyle = 'rgba(255,255,255,0.03)';
    ctx.strokeRect(o.x, 0, o.w, o.top);
    ctx.strokeRect(o.x, o.top + o.gap, o.w, H - (o.top + o.gap));
  }

  for(let c of coins){
    if(c.collected) continue;
    ctx.beginPath();
    ctx.fillStyle = '#ffd166';
    ctx.arc(c.x, c.y, c.r, 0, Math.PI*2);
    ctx.fill();
    ctx.beginPath();
    ctx.fillStyle = 'rgba(0,0,0,0.12)';
    ctx.arc(c.x+1, c.y+1, c.r*0.5, 0, Math.PI*2);
    ctx.fill();
  }

  Player.draw();

  ctx.font = '600 22px system-ui,Arial';
  ctx.fillStyle = 'rgba(255,255,255,0.06)';
  ctx.fillText(' ', 10, 30);
}

function loop(t){
  if(!running) return;
  if(!lastTime) lastTime = t;
  const dt = Math.min(0.05, (t - lastTime)/1000);
  lastTime = t;
  update(dt);
  draw();
  requestAnimationFrame(loop);
}

function toggleDirection(){
  Player.dir *= -1;
  Player.vy = rand(-2.2, 2.2);
  beep(720,0.04,0.04);
}
canvas.addEventListener('touchstart', e=>{
  e.preventDefault();
  if(!running) startGame();
  toggleDirection();
}, {passive:false});
canvas.addEventListener('mousedown', e=>{
  if(!running) startGame();
  toggleDirection();
});
window.addEventListener('keydown', e=>{
  if(e.code === 'Space' || e.code === 'ArrowUp' || e.code === 'KeyW'){
    if(!running) startGame();
    toggleDirection();
  }
});

function showOverlay(html){
  overlay.innerHTML = '';
  const card = document.createElement('div');
  card.style.background = 'linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.1))';
  card.style.padding = '18px';
  card.style.borderRadius = '12px';
  card.style.boxShadow = '0 10px 30px rgba(2,6,23,0.6)';
  card.style.maxWidth = '420px';
  card.style.textAlign = 'center';
  card.style.pointerEvents = 'auto';
  card.innerHTML = html;
  overlay.appendChild(card);
}
function startScreen(){
  overlay.innerHTML = '';
  showOverlay(`
    <h2 style="margin:0;color:var(--accent)">AeroTap</h2>
    <p class="muted" style="margin:10px 0">Tap to play! Collect coins and reach the highest score.</p>
    <div style="margin-top:10px">
      <button id="playNow" class="btn">Play Now</button>
    </div>
    <p class="muted" style="margin-top:8px;font-size:13px">Tip: integrate rewarded ads to offer continues or coins.</p>
  `);
  document.getElementById('playNow').onclick = ()=>{ startGame(); };
}
function endScreen(){
  overlay.innerHTML = '';
  const html = `
    <h2 style="margin:0;color:#ff8a8a">Game Over</h2>
    <p style="margin:8px 0;font-weight:700;font-size:18px">${score} points</p>
    <p class="muted">Best: ${best}</p>
    <div style="margin-top:10px;display:flex;gap:8px;justify-content:center">
      <button id="retry" class="btn">Retry</button>
      <button id="share" class="btn" style="background:#5ad27a">Share</button>
    </div>
    <p class="muted" style="margin-top:8px">Use coins to buy skins — monetize with IAP or ads.</p>
  `;
  showOverlay(html);
  document.getElementById('retry').onclick = ()=>{ startGame(); };
  document.getElementById('share').onclick = ()=>{ shareResult(); };
}

function startGame(){
  obstacles = []; coins = []; score = 0; speed = 2.2; spawnInterval = 1200;
  scoreEl.textContent = score;
  Player.reset();
  running = true;
  overlay.innerHTML = '';
  lastTime = 0;
  if(audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
  requestAnimationFrame(loop);
}
function endGame(){
  running = false;
  if(score > best){ best = score; localStorage.setItem('aerotap_best', best); bestEl.textContent = best; }
  endScreen();
  beep(220,0.18,0.12);
}

function shareResult(){
  const text = `I played AeroTap and scored ${score} points! Can you beat me?`;
  if(navigator.share){
    navigator.share({title:'AeroTap', text, url: location.href});
  } else {
    navigator.clipboard?.writeText(text + ' ' + location.href).then(()=>alert('Link copied! Share it with your friends.'));
  }
}

startBtn.onclick = ()=>{ if(!running) startGame(); else endGame(); };
muteBtn.onclick = ()=>{ soundOn = !soundOn; muteBtn.textContent = soundOn ? 'Mute' : 'Sound'; muteBtn.style.opacity = soundOn ? 1 : 0.6; };

startScreen();

document.addEventListener('visibilitychange', ()=>{
  if(document.hidden && running) { running = false; showOverlay('<div style="background:transparent;padding:8px;border-radius:8px;"><p class="muted">Paused</p><button id="resume" class="btn">Resume</button></div>'); document.getElementById('resume').onclick = ()=>{ overlay.innerHTML=''; running=true; lastTime=0; requestAnimationFrame(loop); }; }
});
</script>
</body>
</html>
